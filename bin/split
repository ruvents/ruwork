#!/usr/bin/env bash

TRAVIS_BRANCH=${TRAVIS_BRANCH:-master}

if [[ ${TRAVIS_BRANCH} != 'master' && ! ${TRAVIS_BRANCH} =~ ^[0-9]+\.[0-9]+$ ]] ; then
    echo "Branch ${TRAVIS_BRANCH} is not allowed for splitting.";
    exit;
fi

tag=`git describe --abbrev=0 --tags`

echo "Splitting branch ${TRAVIS_BRANCH} and tag ${tag}...";

git push git@github.com:ruvents/ruwork-admin-bundle.git `bin/splitsh-lite --prefix=src/AdminBundle --origin=refs/heads/${TRAVIS_BRANCH}`:refs/heads/${TRAVIS_BRANCH}
git push git@github.com:ruvents/ruwork-admin-bundle.git `bin/splitsh-lite --prefix=src/AdminBundle --origin=refs/tags/${tag}`:refs/tags/${tag}

git push git@github.com:ruvents/ruwork-annotation-tools.git `bin/splitsh-lite --prefix=src/AnnotationTools --origin=refs/heads/${TRAVIS_BRANCH}`:refs/heads/${TRAVIS_BRANCH}
git push git@github.com:ruvents/ruwork-annotation-tools.git `bin/splitsh-lite --prefix=src/AnnotationTools --origin=refs/tags/${tag}`:refs/tags/${tag}

git push git@github.com:ruvents/ruwork-api-bundle.git `bin/splitsh-lite --prefix=src/ApiBundle --origin=refs/heads/${TRAVIS_BRANCH}`:refs/heads/${TRAVIS_BRANCH}
git push git@github.com:ruvents/ruwork-api-bundle.git `bin/splitsh-lite --prefix=src/ApiBundle --origin=refs/tags/${tag}`:refs/tags/${tag}

git push git@github.com:ruvents/ruwork-aws-bundle.git `bin/splitsh-lite --prefix=src/AwsBundle --origin=refs/heads/${TRAVIS_BRANCH}`:refs/heads/${TRAVIS_BRANCH}
git push git@github.com:ruvents/ruwork-aws-bundle.git `bin/splitsh-lite --prefix=src/AwsBundle --origin=refs/tags/${tag}`:refs/tags/${tag}

git push git@github.com:ruvents/ruwork-bundle-test.git `bin/splitsh-lite --prefix=src/BundleTest --origin=refs/heads/${TRAVIS_BRANCH}`:refs/heads/${TRAVIS_BRANCH}
git push git@github.com:ruvents/ruwork-bundle-test.git `bin/splitsh-lite --prefix=src/BundleTest --origin=refs/tags/${tag}`:refs/tags/${tag}

git push git@github.com:ruvents/ruwork-bundle.git `bin/splitsh-lite --prefix=src/RuworkBundle --origin=refs/heads/${TRAVIS_BRANCH}`:refs/heads/${TRAVIS_BRANCH}
git push git@github.com:ruvents/ruwork-bundle.git `bin/splitsh-lite --prefix=src/RuworkBundle --origin=refs/tags/${tag}`:refs/tags/${tag}

git push git@github.com:ruvents/ruwork-doctrine-behaviors-bundle.git `bin/splitsh-lite --prefix=src/DoctrineBehaviorsBundle --origin=refs/heads/${TRAVIS_BRANCH}`:refs/heads/${TRAVIS_BRANCH}
git push git@github.com:ruvents/ruwork-doctrine-behaviors-bundle.git `bin/splitsh-lite --prefix=src/DoctrineBehaviorsBundle --origin=refs/tags/${tag}`:refs/tags/${tag}

git push git@github.com:ruvents/ruwork-doctrine-postgresql-bundle.git `bin/splitsh-lite --prefix=src/DoctrinePostgresqlBundle --origin=refs/heads/${TRAVIS_BRANCH}`:refs/heads/${TRAVIS_BRANCH}
git push git@github.com:ruvents/ruwork-doctrine-postgresql-bundle.git `bin/splitsh-lite --prefix=src/DoctrinePostgresqlBundle --origin=refs/tags/${tag}`:refs/tags/${tag}

git push git@github.com:ruvents/ruwork-feature-bundle.git `bin/splitsh-lite --prefix=src/FeatureBundle --origin=refs/heads/${TRAVIS_BRANCH}`:refs/heads/${TRAVIS_BRANCH}
git push git@github.com:ruvents/ruwork-feature-bundle.git `bin/splitsh-lite --prefix=src/FeatureBundle --origin=refs/tags/${tag}`:refs/tags/${tag}

git push git@github.com:ruvents/ruwork-filter-bundle.git `bin/splitsh-lite --prefix=src/FilterBundle --origin=refs/heads/${TRAVIS_BRANCH}`:refs/heads/${TRAVIS_BRANCH}
git push git@github.com:ruvents/ruwork-filter-bundle.git `bin/splitsh-lite --prefix=src/FilterBundle --origin=refs/tags/${tag}`:refs/tags/${tag}

git push git@github.com:ruvents/ruwork-frujax-bundle.git `bin/splitsh-lite --prefix=src/FrujaxBundle --origin=refs/heads/${TRAVIS_BRANCH}`:refs/heads/${TRAVIS_BRANCH}
git push git@github.com:ruvents/ruwork-frujax-bundle.git `bin/splitsh-lite --prefix=src/FrujaxBundle --origin=refs/tags/${tag}`:refs/tags/${tag}

git push git@github.com:ruvents/ruwork-manual-auth-bundle.git `bin/splitsh-lite --prefix=src/ManualAuthBundle --origin=refs/heads/${TRAVIS_BRANCH}`:refs/heads/${TRAVIS_BRANCH}
git push git@github.com:ruvents/ruwork-manual-auth-bundle.git `bin/splitsh-lite --prefix=src/ManualAuthBundle --origin=refs/tags/${tag}`:refs/tags/${tag}

git push git@github.com:ruvents/ruwork-paginator-bundle.git `bin/splitsh-lite --prefix=src/PaginatorBundle --origin=refs/heads/${TRAVIS_BRANCH}`:refs/heads/${TRAVIS_BRANCH}
git push git@github.com:ruvents/ruwork-paginator-bundle.git `bin/splitsh-lite --prefix=src/PaginatorBundle --origin=refs/tags/${tag}`:refs/tags/${tag}

git push git@github.com:ruvents/ruwork-paginator.git `bin/splitsh-lite --prefix=src/Paginator --origin=refs/heads/${TRAVIS_BRANCH}`:refs/heads/${TRAVIS_BRANCH}
git push git@github.com:ruvents/ruwork-paginator.git `bin/splitsh-lite --prefix=src/Paginator --origin=refs/tags/${tag}`:refs/tags/${tag}

git push git@github.com:ruvents/ruwork-reform-bundle.git `bin/splitsh-lite --prefix=src/ReformBundle --origin=refs/heads/${TRAVIS_BRANCH}`:refs/heads/${TRAVIS_BRANCH}
git push git@github.com:ruvents/ruwork-reform-bundle.git `bin/splitsh-lite --prefix=src/ReformBundle --origin=refs/tags/${tag}`:refs/tags/${tag}

git push git@github.com:ruvents/ruwork-reform.git `bin/splitsh-lite --prefix=src/Reform --origin=refs/heads/${TRAVIS_BRANCH}`:refs/heads/${TRAVIS_BRANCH}
git push git@github.com:ruvents/ruwork-reform.git `bin/splitsh-lite --prefix=src/Reform --origin=refs/tags/${tag}`:refs/tags/${tag}

git push git@github.com:ruvents/ruwork-route-optional-prefix.git `bin/splitsh-lite --prefix=src/RouteOptionalPrefix --origin=refs/heads/${TRAVIS_BRANCH}`:refs/heads/${TRAVIS_BRANCH}
git push git@github.com:ruvents/ruwork-route-optional-prefix.git `bin/splitsh-lite --prefix=src/RouteOptionalPrefix --origin=refs/tags/${tag}`:refs/tags/${tag}

git push git@github.com:ruvents/ruwork-routing-tools-bundle.git `bin/splitsh-lite --prefix=src/RoutingToolsBundle --origin=refs/heads/${TRAVIS_BRANCH}`:refs/heads/${TRAVIS_BRANCH}
git push git@github.com:ruvents/ruwork-routing-tools-bundle.git `bin/splitsh-lite --prefix=src/RoutingToolsBundle --origin=refs/tags/${tag}`:refs/tags/${tag}

git push git@github.com:ruvents/ruwork-runet-id-bundle.git `bin/splitsh-lite --prefix=src/RunetIdBundle --origin=refs/heads/${TRAVIS_BRANCH}`:refs/heads/${TRAVIS_BRANCH}
git push git@github.com:ruvents/ruwork-runet-id-bundle.git `bin/splitsh-lite --prefix=src/RunetIdBundle --origin=refs/tags/${tag}`:refs/tags/${tag}

git push git@github.com:ruvents/ruwork-synchronizer-bundle.git `bin/splitsh-lite --prefix=src/SynchronizerBundle --origin=refs/heads/${TRAVIS_BRANCH}`:refs/heads/${TRAVIS_BRANCH}
git push git@github.com:ruvents/ruwork-synchronizer-bundle.git `bin/splitsh-lite --prefix=src/SynchronizerBundle --origin=refs/tags/${tag}`:refs/tags/${tag}

git push git@github.com:ruvents/ruwork-synchronizer.git `bin/splitsh-lite --prefix=src/Synchronizer --origin=refs/heads/${TRAVIS_BRANCH}`:refs/heads/${TRAVIS_BRANCH}
git push git@github.com:ruvents/ruwork-synchronizer.git `bin/splitsh-lite --prefix=src/Synchronizer --origin=refs/tags/${tag}`:refs/tags/${tag}

git push git@github.com:ruvents/ruwork-template-i18n-bundle.git `bin/splitsh-lite --prefix=src/TemplateI18nBundle --origin=refs/heads/${TRAVIS_BRANCH}`:refs/heads/${TRAVIS_BRANCH}
git push git@github.com:ruvents/ruwork-template-i18n-bundle.git `bin/splitsh-lite --prefix=src/TemplateI18nBundle --origin=refs/tags/${tag}`:refs/tags/${tag}

git push git@github.com:ruvents/ruwork-upload-bundle.git `bin/splitsh-lite --prefix=src/UploadBundle --origin=refs/heads/${TRAVIS_BRANCH}`:refs/heads/${TRAVIS_BRANCH}
git push git@github.com:ruvents/ruwork-upload-bundle.git `bin/splitsh-lite --prefix=src/UploadBundle --origin=refs/tags/${tag}`:refs/tags/${tag}

git push git@github.com:ruvents/ruwork-wizard-bundle.git `bin/splitsh-lite --prefix=src/WizardBundle --origin=refs/heads/${TRAVIS_BRANCH}`:refs/heads/${TRAVIS_BRANCH}
git push git@github.com:ruvents/ruwork-wizard-bundle.git `bin/splitsh-lite --prefix=src/WizardBundle --origin=refs/tags/${tag}`:refs/tags/${tag}

echo "Splitting complete.";
