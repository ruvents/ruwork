#!/usr/bin/env bash

set -e

if [ ! -f bin/.splitsh/splitsh-lite ]; then
    mkdir -p bin/.splitsh/

    if [[ $OSTYPE == darwin* ]]; then
        curl -L https://github.com/splitsh/lite/releases/download/v1.0.1/lite_darwin_amd64.tar.gz > bin/.splitsh/splitsh-lite.tar.gz
    else
        curl -L https://github.com/splitsh/lite/releases/download/v1.0.1/lite_linux_amd64.tar.gz > bin/.splitsh/splitsh-lite.tar.gz
    fi

    tar -zxvf bin/.splitsh/splitsh-lite.tar.gz -C bin/.splitsh/  --strip-components=1
    chmod 755 bin/.splitsh/splitsh-lite
fi

while getopts ":t:" opt; do
  case $opt in
    t)
      splitsh_flags="--target=tags/$OPTARG"
      git_flags=$OPTARG
      ;;
    \?)
      echo "Invalid option: -$OPTARG" >&2
      exit 1
      ;;
    :)
      echo "Option -$OPTARG requires an argument." >&2
      exit 1
      ;;
  esac
done

git push https://github.com/ruvents/ruwork-admin-bundle.git `bin/.splitsh/splitsh-lite --prefix=src/AdminBundle ${splitsh_flags}`:master ${git_flags}
git push https://github.com/ruvents/ruwork-api-bundle.git `bin/.splitsh/splitsh-lite --prefix=src/ApiBundle ${splitsh_flags}`:master ${git_flags}
git push https://github.com/ruvents/ruwork-bundle-test.git `bin/.splitsh/splitsh-lite --prefix=src/BundleTest ${splitsh_flags}`:master ${git_flags}
git push https://github.com/ruvents/ruwork-bundle.git `bin/.splitsh/splitsh-lite --prefix=src/RuworkBundle ${splitsh_flags}`:master ${git_flags}
git push https://github.com/ruvents/ruwork-doctrine-behaviors-bundle.git `bin/.splitsh/splitsh-lite --prefix=src/DoctrineBehaviorsBundle ${splitsh_flags}`:master ${git_flags}
git push https://github.com/ruvents/ruwork-doctrine-postgresql-bundle.git `bin/.splitsh/splitsh-lite --prefix=src/DoctrinePostgresqlBundle ${splitsh_flags}`:master ${git_flags}
git push https://github.com/ruvents/ruwork-feature-bundle.git `bin/.splitsh/splitsh-lite --prefix=src/FeatureBundle ${splitsh_flags}`:master ${git_flags}
git push https://github.com/ruvents/ruwork-filter-bundle.git `bin/.splitsh/splitsh-lite --prefix=src/FilterBundle ${splitsh_flags}`:master ${git_flags}
git push https://github.com/ruvents/ruwork-frujax-bundle.git `bin/.splitsh/splitsh-lite --prefix=src/FrujaxBundle ${splitsh_flags}`:master ${git_flags}
git push https://github.com/ruvents/ruwork-manual-auth-bundle.git `bin/.splitsh/splitsh-lite --prefix=src/ManualAuthBundle ${splitsh_flags}`:master ${git_flags}
git push https://github.com/ruvents/ruwork-paginator-bundle.git `bin/.splitsh/splitsh-lite --prefix=src/PaginatorBundle ${splitsh_flags}`:master ${git_flags}
git push https://github.com/ruvents/ruwork-paginator.git `bin/.splitsh/splitsh-lite --prefix=src/Paginator ${splitsh_flags}`:master ${git_flags}
git push https://github.com/ruvents/ruwork-reform-bundle.git `bin/.splitsh/splitsh-lite --prefix=src/ReformBundle ${splitsh_flags}`:master ${git_flags}
git push https://github.com/ruvents/ruwork-reform.git `bin/.splitsh/splitsh-lite --prefix=src/Reform ${splitsh_flags}`:master ${git_flags}
git push https://github.com/ruvents/ruwork-route-optional-prefix.git `bin/.splitsh/splitsh-lite --prefix=src/RouteOptionalPrefix ${splitsh_flags}`:master ${git_flags}
git push https://github.com/ruvents/ruwork-routing-tools-bundle.git `bin/.splitsh/splitsh-lite --prefix=src/RoutingToolsBundle ${splitsh_flags}`:master ${git_flags}
git push https://github.com/ruvents/ruwork-runet-id-bundle.git `bin/.splitsh/splitsh-lite --prefix=src/RunetIdBundle ${splitsh_flags}`:master ${git_flags}
git push https://github.com/ruvents/ruwork-synchronizer-bundle.git `bin/.splitsh/splitsh-lite --prefix=src/SynchronizerBundle ${splitsh_flags}`:master ${git_flags}
git push https://github.com/ruvents/ruwork-synchronizer.git `bin/.splitsh/splitsh-lite --prefix=src/Synchronizer ${splitsh_flags}`:master ${git_flags}
git push https://github.com/ruvents/ruwork-template-i18n-bundle.git `bin/.splitsh/splitsh-lite --prefix=src/TemplateI18nBundle ${splitsh_flags}`:master ${git_flags}
git push https://github.com/ruvents/ruwork-upload-bundle.git `bin/.splitsh/splitsh-lite --prefix=src/UploadBundle ${splitsh_flags}`:master ${git_flags}
git push https://github.com/ruvents/ruwork-wizard-bundle.git `bin/.splitsh/splitsh-lite --prefix=src/WizardBundle ${splitsh_flags}`:master ${git_flags}
